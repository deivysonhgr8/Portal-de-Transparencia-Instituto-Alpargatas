<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Transparência: Instituto Alpargatas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        :root {
            --cor-primaria: #002D5B; /* Azul Alpargatas */
            --cor-acento: #F26522; /* Laranja IA */
            --cor-fundo: #F7F9FC;
            --cor-texto: #333333;
        }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; color: var(--cor-texto); }
        .nav-link {
            transition: color 0.3s ease, border-bottom-color 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--cor-acento);
            border-bottom-color: var(--cor-acento);
        }
        .section-title {
            color: var(--cor-primaria);
            font-weight: 800;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .leaflet-control-container .legend {
            padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif;
            background: white; background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px;
            line-height: 18px; color: #555;
        }
        .leaflet-control-container .legend i {
            width: 18px; height: 18px; float: left;
            margin-right: 8px; opacity: 0.9;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        .custom-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24' fill='%236B7280'%3E%3Cpath d='M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
        }
        
        .projeto-btn {
            background-color: #F7F9FC;
            color: #6b7280;
            border: 2px solid #e2e8f0;
        }
        .projeto-btn:hover {
            background-color: #e2e8f0;
            border-color: #cbd5e1;
        }
        .projeto-btn.active-btn {
            background-color: #FFF7ED;
            color: var(--cor-acento);
            border-color: var(--cor-acento);
            font-weight: 700;
        }
        
        #quem-somos {
            position: relative;
            background-image: url('fundo título.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #quem-somos::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 45, 91, 0.7);
            z-index: 1;
        }
        #quem-somos .container {
            position: relative;
            z-index: 2;
        }
        #quem-somos h1, #quem-somos p {
            color: white;
        }

        #interactive-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        body { background-color: transparent; }
        section#quem-somos.bg-white,
        section#o-que-fazemos, 
        section#iqe-mapa.bg-white,
        section#analise-municipal, 
        section#inteligencia,
        section#inteligencia.bg-white {
            background-color: transparent !important;
        }

        .icon-animation-container {
            position: relative;
            width: 130px;
            height: 130px;
            margin: 0 auto;
        }
        .icon-animation-container .material-symbols-outlined {
            position: absolute;
            top: 50%;
            left: 50%;
            font-size: 60px;
            color: var(--cor-acento);
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }
        .beneficiados-counter {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            text-align: center;
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--cor-primaria);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.7);
            transition: opacity 0.4s ease-in 1.1s, transform 0.4s ease-in 1.1s;
        }
        .circle-svg {
            width: 130px;
            height: 130px;
            transform: rotate(-90deg);
        }
        .circle-bg {
            fill: none;
            stroke: #e2e8f0;
            stroke-width: 8;
        }
        .circle-progress {
            fill: none;
            stroke: var(--cor-acento);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 352;
            stroke-dashoffset: 352;
        }
        
        .animate-circle .circle-progress {
            animation: draw-circle 1.5s ease-out forwards;
        }
        .animate-circle .material-symbols-outlined {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
        }
        .animate-circle .beneficiados-counter {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        @keyframes draw-circle {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        /* --- ESTILOS PARA INTERFACE DE CHAT --- */
        #chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-message {
            padding: 0.75rem 1.25rem;
            border-radius: 1.25rem;
            max-width: 80%;
            line-height: 1.5;
        }
        .user-message {
            background-color: var(--cor-primaria);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .bot-message {
            background-color: #f1f5f9;
            color: var(--cor-texto);
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }
        #chat-form {
            display: flex;
            border-top: 1px solid #e2e8f0;
        }
        #chat-input {
            flex-grow: 1;
            border: none;
            padding: 1rem 1.5rem;
            outline: none;
            background-color: #f8fafc;
        }
        #chat-submit {
            background-color: var(--cor-acento);
            color: white;
            border: none;
            padding: 0 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #chat-submit:hover {
            background-color: #dd571c;
        }
    </style>
</head>
<body class="antialiased">
    <canvas id="interactive-background"></canvas>

    <header id="header" class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="IA.png" alt="Logo IA" class="h-10 w-10">
                <span class="text-xl font-bold text-gray-700">Instituto Alpargatas</span>
            </div>
            <nav class="hidden md:flex space-x-6">
                <a href="#quem-somos" class="nav-link text-gray-600 font-medium">Quem Somos</a>
                <a href="#o-que-fazemos" class="nav-link text-gray-600 font-medium">O Que Fazemos</a>
                <a href="#iqe-mapa" class="nav-link text-gray-600 font-medium">Mapa IQE</a>
                <a href="#analise-municipal" class="nav-link text-gray-600 font-medium">Análise Municipal</a>
                <a href="#inteligencia" class="nav-link text-gray-600 font-medium">Inteligência Municipal</a>
            </nav>
            <div class="md:hidden">
                <button id="menu-btn" class="text-gray-700 focus:outline-none">
                    <span class="material-symbols-outlined">menu</span>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden bg-white">
            <a href="#quem-somos" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100 mobile-link">Quem Somos</a>
            <a href="#o-que-fazemos" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100 mobile-link">O Que Fazemos</a>
            <a href="#iqe-mapa" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100 mobile-link">Mapa IQE</a>
            <a href="#analise-municipal" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100 mobile-link">Análise Municipal</a>
            <a href="#inteligencia" class="block py-2 px-6 text-sm text-gray-700 hover:bg-gray-100 mobile-link">Inteligência Municipal</a>
        </div>
    </header>

    <main>
        <section id="quem-somos" class="py-20 bg-white">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-5xl font-extrabold mb-6 fade-in" style="color:white;">Portal de Transparência: Instituto Alpargatas</h1>
                <p class="max-w-4xl mx-auto text-lg leading-relaxed fade-in" style="animation-delay: 200ms; color: white;">
                    Neste cenário complexo da educação brasileira, o <strong>Instituto Alpargatas</strong> posiciona-se como uma organização do terceiro setor, de caráter privado e sem fins lucrativos, cuja missão é catalisar a melhoria da qualidade da educação pública. Atuando em regime de colaboração com o poder público, o Instituto desenvolve e implementa projetos que visam fortalecer a gestão educacional, qualificar as práticas pedagógicas e promover o engajamento das comunidades escolares.
                </p>
            </div>
        </section>

        <section id="o-que-fazemos" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl section-title">Nossa Atuação Estratégica</h2>
                    <p class="max-w-3xl mx-auto text-lg text-gray-600 mt-4">
                        Selecione um de nossos eixos de atuação para conhecer o impacto gerado, os projetos desenvolvidos e o total de vidas transformadas.
                    </p>
                </div>

                <div class="card max-w-4xl mx-auto p-8">
                    <div id="projeto-seletor" class="flex flex-wrap gap-4 mb-8 justify-center">
                        <button data-projeto="esporte" class="projeto-btn flex-1 min-w-[180px] text-center font-medium py-3 px-4 rounded-lg transition-all duration-300">Educação pelo Esporte</button>
                        <button data-projeto="cultura" class="projeto-btn flex-1 min-w-[180px] text-center font-medium py-3 px-4 rounded-lg transition-all duration-300">Educação pela Cultura</button>
                        <button data-projeto="profissionalizante" class="projeto-btn flex-1 min-w-[180px] text-center font-medium py-3 px-4 rounded-lg transition-all duration-300">Educação Profissionalizante</button>
                    </div>

                    <div id="projeto-container">
                        </div>
                </div>
            </div>
        </section>

        <section id="iqe-mapa" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                 <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl section-title mb-4">Mapa do IQE - Índice de Qualidade da Educação</h2>
                    <p class="max-w-3xl mx-auto text-lg text-gray-600">
                        Visualização do <strong>Índice de Qualidade da Educação (IQE)</strong> nos municípios de atuação do Instituto. O IQE é um indicador multidimensional (escala de 1 a 10) que avalia a educação de forma mais completa, considerando fatores como desempenho, fluxo escolar, equidade e infraestrutura.
                    </p>
                </div>
                <div id="map" class="h-[600px] w-full rounded-lg shadow-lg border-2 border-gray-200"></div>
            </div>
        </section>
        
        <section id="analise-municipal" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                     <h2 class="text-3xl md:text-4xl section-title mb-4">Análise Municipal do IQE</h2>
                    <p class="max-w-3xl mx-auto text-lg text-gray-600">Selecione um município para visualizar seu Índice de Qualidade da Educação (IQE) e entender o contexto socioeconômico e os resultados detalhados.</p>
                </div>
                
                <div class="card p-8 max-w-4xl mx-auto">
                    <div class="mb-8">
                        <label for="municipio-select" class="block text-sm font-medium text-gray-700 mb-2">Selecione o Município:</label>
                        <select id="municipio-select" class="custom-select mt-1 block w-full pl-4 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md shadow-sm"></select>
                    </div>

                    <div id="analise-container" class="grid lg:grid-cols-2 gap-8 items-center opacity-0 transition-opacity duration-500">
                        <div class="space-y-4">
                            <h3 id="analise-municipio-nome" class="text-2xl lg:text-3xl font-bold text-center" style="color: var(--cor-acento);"></h3>
                            <div class="bg-gray-200 rounded-full h-5 w-full overflow-hidden">
                                <div id="iqe-linha" class="h-5 rounded-full transition-all duration-1000 ease-out flex items-center justify-end pr-2" style="width: 0%;">
                                     <span id="iqe-valor-texto-linha" class="text-white font-bold text-sm"></span>
                                </div>
                            </div>
                            <p class="text-center text-gray-600 font-medium">Nível do IQE (1 a 10)</p>
                        </div>
                        <div id="analise-texto-container">
                             <h3 class="text-xl font-bold text-gray-800 mb-2">Contexto Municipal</h3>
                             <p id="iqe-contexto" class="text-gray-600 mb-4 text-justify"></p>
                             <h3 class="text-xl font-bold text-gray-800 mb-2">Análise do IQE</h3>
                             <p id="iqe-analise" class="text-gray-600 text-justify"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="inteligencia" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                 <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl section-title mb-4">Inteligência Municipal Interativa</h2>
                    <p class="max-w-3xl mx-auto text-lg text-gray-600">
                        Faça uma pergunta ao nosso assistente para obter análises sobre o desempenho educacional e o potencial de investimento nos municípios.
                    </p>
                </div>
                <div class="card max-w-2xl mx-auto p-8">
                    <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800">
                        <p class="font-bold mb-2">Aviso Importante</p>
                        <p class="mb-3">Os dados de 'Retorno sobre Investimento' são gerados por um modelo preditivo treinado com <strong>dados simulados</strong>, exclusivamente para fins de demonstração da ferramenta.</p>
                        <p class="font-semibold">Experimente os seguintes comandos:</p>
                        <ul class="list-disc list-inside mt-1">
                            <li><code>destaques</code></li>
                            <li><code>pontos críticos</code></li>
                            <li><code>investimento em [nome do município]</code> (ex: <code>investimento em Campina Grande</code>)</li>
                        </ul>
                    </div>

                    <div id="chat-container">
                        <div id="chat-messages">
                             <div class="chat-message bot-message">Olá! Como posso ajudar a analisar os dados educacionais hoje?</div>
                        </div>
                        <form id="chat-form">
                            <input type="text" id="chat-input" placeholder="Digite seu comando aqui..." autocomplete="off">
                            <button type="submit" id="chat-submit">
                                <span class="material-symbols-outlined">send</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        </main>
    
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Instituto Alpargatas. Todos os direitos reservados.</p>
            <p class="text-sm text-gray-400 mt-2">Uma Análise de Impacto do IQE, Censo Escolar e Saeb.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- MENU MOBILE ---
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileLinks = document.querySelectorAll('.mobile-link');
            
            menuBtn.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });
            mobileLinks.forEach(link => { link.addEventListener('click', () => { mobileMenu.classList.add('hidden'); }); });

            // --- NAVEGAÇÃO ATIVA ---
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('nav a, #mobile-menu a');
            window.onscroll = () => {
                let current = 'quem-somos';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 70) { current = section.getAttribute('id'); }
                });
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').substring(1) === current) {
                        link.classList.add('active');
                    }
                });
            };

            // --- LÓGICA DOS PROJETOS COM ANIMAÇÃO ---
            const projetosData = {
                esporte: {
                    icone: 'sports_soccer',
                    titulo: 'Educação pelo Esporte',
                    descricao: 'É um programa que visa melhorar a educação de crianças e jovens por meio da prática esportiva e cultural. O instituto atua em parceria com secretarias municipais de educação e escolas públicas para desenvolver competências socioemocionais e cognitivas, promover a participação de alunos e valorizar experiências inovadoras de ensino.',
                    beneficiados: '158.209'
                },
                cultura: {
                    icone: 'theater_comedy',
                    titulo: 'Educação pela Cultura',
                    descricao: 'Um programa que promove a inclusão de atividades pedagógicas não tradicionais, resgatando a cultura popular brasileira, especialmente a afro-brasileira e a indígena, por meio da formação de professores. O programa busca valorizar a identidade e os saberes locais, incentivando a criatividade e a multiplicidade de formas de expressão cultural nos alunos e educadores, contemplando projetos como EDUCAÇÃO INTEGRAL e CAPOEIRA INCLUSIVA.',
                    beneficiados: '158.367'
                },
                profissionalizante: {
                    icone: 'work',
                    titulo: 'Educação Profissionalizante',
                    descricao: 'O Instituto Alpargatas promove projetos de educação profissionalizante por meio de parcerias com prefeituras locais, como em Guarabira e Fagundes, oferecendo cursos gratuitos para qualificar jovens e adultos para o mercado de trabalho. Além disso, o instituto apoia a educação em diversas frentes, incluindo programas como o prêmio "Educador Nota 10" e iniciativas de capacitação como os Laboratórios de Inovação e Sustentabilidade Educacional (LISE).',
                    beneficiados: '4.119'
                }
            };

            const seletorContainer = document.getElementById('projeto-seletor');
            const projetoContainer = document.getElementById('projeto-container');
            const projetoBtns = document.querySelectorAll('.projeto-btn');

            function animateCounter(element, finalNumberStr) {
                const finalNumber = parseInt(finalNumberStr.replace(/\./g, ''));
                const duration = 1500; 
                let currentNumber = 0;
                const frameDuration = 1000 / 60; // 60fps
                const totalFrames = Math.round(duration / frameDuration);
                const increment = finalNumber / totalFrames;

                const updateCount = () => {
                    currentNumber += increment;
                    if (currentNumber >= finalNumber) {
                        element.innerText = finalNumber.toLocaleString('pt-BR');
                        return;
                    }
                    element.innerText = Math.floor(currentNumber).toLocaleString('pt-BR');
                    requestAnimationFrame(updateCount);
                };
                requestAnimationFrame(updateCount);
            }
            
            function updateProjectView(projetoKey) {
                const projeto = projetosData[projetoKey];
                if (!projeto) return;

                projetoContainer.innerHTML = `
                    <div class="grid md:grid-cols-3 gap-8 items-center text-center md:text-left fade-in">
                        <div class="md:col-span-1 flex flex-col items-center">
                            <div class="icon-animation-container">
                                <span class="material-symbols-outlined">${projeto.icone}</span>
                                <div class="beneficiados-counter">0</div>
                                <svg class="circle-svg" viewBox="0 0 120 120">
                                    <circle class="circle-bg" cx="60" cy="60" r="56"></circle>
                                    <circle class="circle-progress" cx="60" cy="60" r="56"></circle>
                                </svg>
                            </div>
                            <p class="text-sm text-gray-500 uppercase font-medium mt-3">Total de Beneficiados</p>
                        </div>
                        <div class="md:col-span-2">
                            <h3 class="text-2xl font-bold mb-3" style="color: var(--cor-acento);">${projeto.titulo}</h3>
                            <p class="text-gray-600 leading-relaxed text-justify">${projeto.descricao}</p>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    const animationContainer = projetoContainer.querySelector('.icon-animation-container');
                    const counterElement = projetoContainer.querySelector('.beneficiados-counter');
                    if (animationContainer && counterElement) {
                        animationContainer.classList.add('animate-circle');
                        
                        setTimeout(() => {
                            animateCounter(counterElement, projeto.beneficiados);
                        }, 1100);
                    }
                }, 100); 

                projetoBtns.forEach(btn => {
                    btn.classList.remove('active-btn');
                    if(btn.dataset.projeto === projetoKey) {
                        btn.classList.add('active-btn');
                    }
                });
            }

            seletorContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('projeto-btn')) {
                    const projetoKey = e.target.dataset.projeto;
                    updateProjectView(projetoKey);
                }
            });

            updateProjectView('esporte');
            
            // --- [INÍCIO DA LÓGICA ATUALIZADA] ---
            
            // --- DADOS DO MAPA E ANÁLISE MUNICIPAL (IQE) ---
            const iqeData = [
                // Adicionando a chave "retorno_por_real" em cada objeto
                { nome: "Cabaceiras", iqe: 10.0, retorno_por_real: 0.00000119, contexto: "Localizada no semiárido paraibano, Cabaceiras é conhecida como a 'Roliúde Nordestina' por ser cenário de muitos filmes nacionais. A cidade enfrenta os desafios do clima seco, mas possui uma forte identidade cultural.", analise: "Com um IQE máximo de 10.0, Cabaceiras é um exemplo de excelência. Este resultado indica um desempenho educacional extraordinário, com altíssima qualidade na infraestrutura escolar, equidade socioeconômica e formação docente, servindo como modelo para outros municípios da região." },
                { nome: "Queimadas", iqe: 9.27, retorno_por_real: 0.00000051, contexto: "Integrando a região metropolitana de Campina Grande, Queimadas é um município com forte atividade industrial e comercial, o que reflete em uma dinâmica socioeconômica mais robusta em comparação com cidades do interior.", analise: "O IQE de 9.27 posiciona Queimadas como um município de altíssimo desempenho. A nota reflete não apenas excelentes resultados de aprendizagem, mas também uma infraestrutura escolar de qualidade e bons indicadores de equidade, potencializados pelo contexto econômico favorável." },
                { nome: "Montes Claros", iqe: 7.85, retorno_por_real: 0.00000241, contexto: "Principal centro urbano do norte de Minas Gerais, Montes Claros é um polo de serviços, educação e saúde para uma vasta região. Enfrenta os desafios de uma cidade de grande porte, com diversidade socioeconômica.", analise: "Atingir um IQE de 7.85 é um resultado sólido e muito positivo para um centro regional como Montes Claros. Indica um sistema educacional bem estruturado, com boa qualidade de ensino e infraestrutura, conseguindo manter um padrão elevado apesar da complexidade urbana." },
                { nome: "Campina Grande", iqe: 5.61, retorno_por_real: 0.00000400, contexto: "Reconhecida como um dos principais polos tecnológicos e universitários do Nordeste, Campina Grande possui uma economia diversificada e uma população com alto nível de instrução em comparação com a média regional.", analise: "O IQE de 5.61 é considerado bom, mas com espaço para melhorias. Reflete a força da infraestrutura e do capital humano da cidade. No entanto, o índice sugere que ainda existem desafios para garantir que a qualidade educacional seja uniforme em todas as escolas, especialmente nas áreas periféricas." },
                { nome: "São Paulo", iqe: 5.11, retorno_por_real: 0.00000350, contexto: "Maior metrópole do Brasil, São Paulo é um centro de imensa diversidade, oportunidades e profundas desigualdades socioeconômicas, o que impõe desafios gigantescos para a gestão da educação pública.", analise: "Um IQE de 5.11 é um indicador de qualidade média e evidencia a complexidade da gestão educacional paulistana. O resultado mostra que, apesar dos recursos disponíveis, a desigualdade entre as diferentes regiões da cidade impacta fortemente a equidade e a qualidade geral da educação." },
                { nome: "Carpina", iqe: 4.44, retorno_por_real: 0.00000429, contexto: "Localizado na Zona da Mata de Pernambuco, Carpina é um importante centro comercial da região, com uma economia baseada no comércio, serviços e na indústria canavieira.", analise: "Com um IQE de 4.44, Carpina está em um patamar intermediário, indicando que existem bases sólidas, mas também desafios importantes a serem superados. A análise sugere a necessidade de foco em áreas como a qualificação docente e a melhoria da infraestrutura para impulsionar a qualidade." },
                { nome: "João Pessoa", iqe: 4.40, retorno_por_real: 0.00000522, contexto: "Capital da Paraíba, João Pessoa é um centro administrativo e turístico com uma boa infraestrutura urbana. A cidade, no entanto, também apresenta bolsões de vulnerabilidade social em suas periferias.", analise: "O IQE de 4.40 para a capital paraibana é um sinal de alerta. Embora a cidade possua recursos, o índice aponta para desafios na garantia de uma educação de alta qualidade de forma equitativa para todos os alunos, indicando que melhorias na infraestrutura e na equidade são necessárias." },
                { nome: "Lagoa Seca", iqe: 3.94, retorno_por_real: 0.00000511, contexto: "Vizinha a Campina Grande, Lagoa Seca tem uma economia com forte base na agricultura e no comércio local, sendo influenciada pela proximidade com um grande centro urbano.", analise: "Um IQE de 3.94 coloca Lagoa Seca em um nível de atenção. O resultado sugere que, embora haja potencial, fatores como infraestrutura escolar e o nível socioeconômico médio dos alunos podem estar limitando um avanço mais significativo na qualidade da educação." },
                { nome: "Guarabira", iqe: 3.05, retorno_por_real: 0.00000537, contexto: "Polo da região do Brejo Paraibano, Guarabira é um centro comercial e de serviços para os municípios do entorno, com uma economia diversificada que inclui agricultura e comércio.", analise: "O IQE de 3.05 indica desafios estruturais importantes no sistema educacional. A nota aponta para a necessidade de investimentos consistentes em múltiplas áreas, desde a infraestrutura das escolas até a formação continuada dos professores, para reverter o quadro atual." },
                { nome: "Alagoa Nova", iqe: 2.94, retorno_por_real: 0.00000575, contexto: "Município localizado no Brejo Paraibano, com economia predominantemente agrícola, especialmente cana-de-açúcar e fruticultura. Apresenta indicadores socioeconômicos modestos.", analise: "Com um IQE de 2.94, Alagoa Nova enfrenta desafios consideráveis. O baixo índice reflete dificuldades em componentes essenciais como infraestrutura e qualificação docente, que impactam diretamente a aprendizagem dos alunos. Ações focadas são cruciais." },
                { nome: "Caturité", iqe: 2.60, retorno_por_real: 0.00000550, contexto: "Pequeno município no Agreste Paraibano, com base econômica na agropecuária e uma população de baixa densidade demográfica.", analise: "O IQE de 2.60 sinaliza a existência de desafios significativos e a necessidade de atenção especial. Este resultado sugere que a infraestrutura escolar e os indicadores socioeconômicos são fatores críticos que precisam ser abordados para que a qualidade da educação possa melhorar." },
                { nome: "Bananeiras", iqe: 2.50, retorno_por_real: 0.00000644, contexto: "Conhecida pelo clima ameno no Brejo Paraibano, Bananeiras tem forte apelo turístico e uma economia que também envolve a agricultura. Possui um contexto socioeconômico heterogêneo.", analise: "Um IQE de 2.50 indica que o município está em um ponto crítico. Apesar de seu potencial turístico, a educação básica enfrenta grandes desafios, provavelmente ligados à infraestrutura e à necessidade de maior investimento na qualificação dos educadores." },
                { nome: "Ingá", iqe: 2.45, retorno_por_real: 0.00000637, contexto: "Famosa pela Pedra do Ingá, um importante monumento arqueológico, a cidade de Ingá, no Agreste Paraibano, tem sua economia centrada na agricultura e no funcionalismo público.", analise: "Com um IQE de 2.45, Ingá também se encontra em uma situação que requer atenção. A nota sugere que as condições de oferta de ensino, como infraestrutura e recursos pedagógicos, são um gargalo importante para a melhoria da qualidade educacional." },
                { nome: "Mogeiro", iqe: 2.22, retorno_por_real: 0.00000542, contexto: "Município do Agreste Paraibano, com economia baseada na agricultura de subsistência e na pecuária, apresentando um perfil socioeconômico de vulnerabilidade.", analise: "O IQE de 2.22 reflete os desafios socioeconômicos enfrentados pelo município. O resultado aponta para a necessidade de intervenções estruturantes, focadas em melhorar as condições básicas das escolas e apoiar os docentes para garantir uma aprendizagem mais eficaz." },
                { nome: "Serra Redonda", iqe: 1.83, retorno_por_real: 0.00000690, contexto: "Pequeno município localizado na mesorregião do Agreste Paraibano, com economia baseada principalmente na agricultura e na pecuária.", analise: "Um IQE de 1.83 indica uma situação educacional muito crítica. Este valor sugere deficiências graves em múltiplos fatores do índice, demandando um plano de ação emergencial para fortalecer a infraestrutura, a gestão e as práticas pedagógicas." },
                { nome: "Santa Rita", iqe: 1.69, retorno_por_real: 0.00000550, contexto: "Integrando a região metropolitana de João Pessoa, Santa Rita é um dos municípios mais populosos da Paraíba, com uma economia industrial forte, mas também com grandes desafios sociais e de infraestrutura urbana.", analise: "O IQE de 1.69 é extremamente baixo para um município com a importância econômica de Santa Rita. O resultado evidencia que o desenvolvimento industrial não se traduziu em qualidade educacional, apontando para profundas desigualdades e carências estruturais no sistema de ensino." },
                { nome: "Itatuba", iqe: 1.0, retorno_por_real: 0.00000633, contexto: "Município situado no Agreste Paraibano, com uma economia de base agrícola e um dos menores Índices de Desenvolvimento Humano (IDH) do estado.", analise: "A nota mínima de 1.0 no IQE sinaliza um cenário de emergência educacional. Este resultado indica que o município enfrenta desafios críticos em todas as dimensões avaliadas, necessitando de um apoio intensivo e urgente para reverter a situação e garantir o direito básico à educação de qualidade." }
            ];

            // LÓGICA DA SEÇÃO 'ANALISE MUNICIPAL'
            const municipioSelect = document.getElementById('municipio-select');
            const iqeContexto = document.getElementById('iqe-contexto');
            const iqeAnalise = document.getElementById('iqe-analise');
            const analiseContainer = document.getElementById('analise-container');
            const iqeLinha = document.getElementById('iqe-linha');
            const iqeValorTexto = document.getElementById('iqe-valor-texto-linha');
            const analiseMunicipioNome = document.getElementById('analise-municipio-nome');
            function getIqeColor(iqe) {
                if (iqe >= 9) return '#1a9850'; if (iqe >= 7) return '#66c2a5'; if (iqe >= 5) return '#fee08b'; if (iqe >= 3) return '#f46d43'; return '#d73027';
            }
            function updateMunicipioAnalise() {
                const selectedMunicipio = iqeData.find(m => m.nome === municipioSelect.value);
                if (!selectedMunicipio) return;
                analiseMunicipioNome.textContent = selectedMunicipio.nome;
                iqeContexto.textContent = selectedMunicipio.contexto;
                iqeAnalise.textContent = selectedMunicipio.analise;
                analiseContainer.classList.remove('opacity-0');
                const iqePercent = (selectedMunicipio.iqe / 10) * 100;
                const iqeColor = getIqeColor(selectedMunicipio.iqe);
                iqeLinha.style.width = '0%';
                iqeValorTexto.textContent = '';
                setTimeout(() => {
                    iqeLinha.style.backgroundColor = iqeColor;
                    iqeLinha.style.width = `${iqePercent}%`;
                    iqeValorTexto.textContent = selectedMunicipio.iqe.toFixed(2);
                }, 100);
            }
            iqeData.sort((a, b) => a.nome.localeCompare(b.nome));
            iqeData.forEach(mun => {
                const option = document.createElement('option');
                option.value = mun.nome;
                option.textContent = mun.nome;
                municipioSelect.appendChild(option);
            });
            municipioSelect.addEventListener('change', updateMunicipioAnalise);
            updateMunicipioAnalise();

            // LÓGICA DA SEÇÃO 'MAPA IQE'
            const map = L.map('map').setView([-7.9, -36.5], 7);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
            }).addTo(map);
            const iqeMap = new Map(iqeData.map(d => [d.nome.toUpperCase(), d.iqe]));
            function style(feature) {
                const nomeMunicipio = feature.properties.name.toUpperCase();
                const iqe = iqeMap.get(nomeMunicipio);
                return { fillColor: iqe ? getIqeColor(iqe) : 'transparent', weight: iqe ? 1.5 : 0.5, opacity: 1, color: iqe ? '#FFF' : '#AAA', dashArray: iqe ? '3' : '', fillOpacity: iqe ? 0.8 : 0.0 };
            }
            function highlightFeature(e) {
                const layer = e.target;
                layer.setStyle({ weight: 4, color: 'var(--cor-primaria)', dashArray: '', fillOpacity: 0.9 });
                if (!L.Browser.ie) layer.bringToFront();
            }
            let geojsonLayer; 
            const resetHighlight = (e) => geojsonLayer.resetStyle(e.target);
            function onEachFeature(feature, layer) {
                const nomeMunicipio = feature.properties.name.toUpperCase();
                const iqe = iqeMap.get(nomeMunicipio);
                if (iqe) {
                    layer.bindPopup(`<b>${feature.properties.name}</b><br>IQE: <b>${iqe.toFixed(2)}</b>`);
                    layer.on({ mouseover: highlightFeature, mouseout: resetHighlight });
                }
            }
            const urlsGeoJSON = {
                'PB': 'https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-25-mun.json', 'PE': 'https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-26-mun.json', 'MG': 'https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-31-mun.json', 'SP': 'https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-35-mun.json'
            };
            Promise.all(Object.values(urlsGeoJSON).map(url => fetch(url).then(res => res.json())))
            .then(allGeoData => {
                const combinedGeoData = { type: "FeatureCollection", features: allGeoData.flatMap(data => data.features) };
                geojsonLayer = L.geoJson(combinedGeoData, { style, onEachFeature }).addTo(map);
                map.fitBounds(geojsonLayer.getBounds());
            }).catch(error => {
                console.error("Erro ao carregar dados geográficos:", error);
                document.getElementById('map').innerHTML = '<p class="text-center text-red-500 p-4">Não foi possível carregar o mapa.</p>';
            });
            const legend = L.control({position: 'bottomright'});
            legend.onAdd = function (map) {
                const div = L.DomUtil.create('div', 'info legend');
                const grades = [1, 3, 5, 7, 9];
                let labels = ['<strong>IQE (1 a 10)</strong>'];
                for (let i = 0; i < grades.length; i++) {
                    labels.push(`<i style="background:${getIqeColor(grades[i] + 0.1)}"></i> ${grades[i]}` + (grades[i+1] ? `&ndash;${grades[i+1]}`: '+'));
                }
                div.innerHTML = labels.join('<br>');
                return div;
            };
            legend.addTo(map);

            // --- LÓGICA DA SEÇÃO 'INTELIGÊNCIA MUNICIPAL' (CHATBOT) ---
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const chatMessagesContainer = document.getElementById('chat-messages');
            
            function appendMessage(text, type) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('chat-message', type, 'fade-in');
                messageDiv.innerHTML = text; // Usar innerHTML para renderizar tags como <br> e <strong>
                chatMessagesContainer.appendChild(messageDiv);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
            }

            function handleDestaques() {
                const destaques = [...iqeData].sort((a, b) => b.iqe - a.iqe).slice(0, 3);
                let response = "<strong>Municípios com maiores Índices de Qualidade da Educação (IQE):</strong><br><br>";
                destaques.forEach(mun => {
                    response += `<strong>${mun.nome} (IQE: ${mun.iqe.toFixed(2)})</strong><br>${mun.contexto}<br><br>`;
                });
                appendMessage(response, 'bot-message');
            }

            function handleCriticos() {
                const criticos = [...iqeData].sort((a, b) => a.iqe - b.iqe).slice(0, 3);
                let response = "<strong>Municípios que representam pontos de atenção máxima (IQE mais baixos):</strong><br><br>";
                criticos.forEach(mun => {
                    response += `<strong>${mun.nome} (IQE: ${mun.iqe.toFixed(2)})</strong><br>${mun.analise}<br><br>`;
                });
                appendMessage(response, 'bot-message');
            }

            function handleDecisao(municipioNome) {
                // Normaliza o nome do município para comparação (remove acentos, cedilha e torna minúsculo)
                const normalizeString = (str) => str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                const nomeNormalizado = normalizeString(municipioNome);
                
                const municipio = iqeData.find(m => normalizeString(m.nome) === nomeNormalizado);
                
                if (!municipio) {
                    appendMessage(`Desculpe, não encontrei dados para "${municipioNome}". Verifique se o nome está correto.`, 'bot-message');
                    return;
                }

                const retornoPercentual = (municipio.retorno_por_real * 100).toFixed(6);
                let response = `<strong>Análise de Retorno sobre Investimento (ROI) para ${municipio.nome}:</strong><br><br>`;
                response += `Com base no modelo preditivo, cada <strong>R$ 1,00</strong> investido em ${municipio.nome} gera um retorno estimado de <strong>${retornoPercentual}%</strong> em pontos de IQE.<br><br>`;
                response += `Isso significa que um investimento padrão de R$ 100.000,00 resultaria em um aumento previsto de aproximadamente <strong>${(municipio.retorno_por_real * 100000).toFixed(2)} pontos</strong> no IQE do município.`;
                appendMessage(response, 'bot-message');
            }

            function processUserInput(input) {
                const lowerInput = input.toLowerCase().trim();

                if (lowerInput.includes('destaque')) {
                    handleDestaques();
                } else if (lowerInput.includes('crítico') || lowerInput.includes('critico')) {
                    handleCriticos();
                } else if (lowerInput.startsWith('investimento em')) {
                    const municipioNome = input.substring('investimento em'.length).trim();
                    if (municipioNome) {
                        handleDecisao(municipioNome);
                    } else {
                        appendMessage('Por favor, especifique um nome de município após "investimento em".', 'bot-message');
                    }
                } else {
                    appendMessage('Desculpe, não entendi. Por favor, use um dos comandos sugeridos, como "destaques", "pontos críticos" ou "investimento em [nome do município]".', 'bot-message');
                }
            }

            chatForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const userInput = chatInput.value.trim();
                if (userInput === '') return;

                appendMessage(userInput, 'user-message');
                chatInput.value = '';

                setTimeout(() => processUserInput(userInput), 500); // Delay para simular "pensamento"
            });
            // --- [FIM DA LÓGICA ATUALIZADA] ---
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const canvas = document.getElementById('interactive-background');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            let mouse = {
                x: null,
                y: null,
                radius: 150
            };

            window.addEventListener('mousemove', function(event) {
                mouse.x = event.x;
                mouse.y = event.y;
            });
            
            window.addEventListener('mouseout', function() {
                mouse.x = undefined;
                mouse.y = undefined;
            });

            let particlesArray = [];

            class Particle {
                constructor(x, y, directionX, directionY, size) {
                    this.x = x;
                    this.y = y;
                    this.directionX = directionX;
                    this.directionY = directionY;
                    this.size = size;
                }
                draw() { /* Partículas invisíveis */ }
                update() {
                    if (this.x > canvas.width || this.x < 0) this.directionX = -this.directionX;
                    if (this.y > canvas.height || this.y < 0) this.directionY = -this.directionY;
                    this.x += this.directionX;
                    this.y += this.directionY;
                    this.draw();
                }
            }

            function init() {
                particlesArray = [];
                let numberOfParticles = (canvas.height * canvas.width) / 25000;
                for (let i = 0; i < numberOfParticles; i++) {
                    let size = 0;
                    let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
                    let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
                    let directionX = (Math.random() * .4) - .2;
                    let directionY = (Math.random() * .4) - .2;
                    particlesArray.push(new Particle(x, y, directionX, directionY, size));
                }
            }

            function connect() {
                let opacityValue = 1;
                for (let a = 0; a < particlesArray.length; a++) {
                    for (let b = a; b < particlesArray.length; b++) {
                        let distance = Math.sqrt(Math.pow(particlesArray[a].x - particlesArray[b].x, 2) + Math.pow(particlesArray[a].y - particlesArray[b].y, 2));
                        if (distance < (canvas.width / 7)) {
                            opacityValue = 1 - (distance / (canvas.width / 7));
                            ctx.strokeStyle = `rgba(0, 45, 91, ${opacityValue * 0.3})`;
                            ctx.lineWidth = 1;
                            ctx.beginPath();
                            ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
                            ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
                            ctx.stroke();
                        }
                    }

                    if (mouse.x != null && mouse.y != null) {
                        let distanceToMouse = Math.sqrt(Math.pow(particlesArray[a].x - mouse.x, 2) + Math.pow(particlesArray[a].y - mouse.y, 2));
                        
                        if (distanceToMouse < mouse.radius) {
                             opacityValue = 1 - (distanceToMouse / mouse.radius);
                             ctx.strokeStyle = `rgba(242, 101, 34, ${opacityValue * 0.8})`;
                             ctx.lineWidth = 1.2;
                             ctx.beginPath();
                             ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
                             ctx.lineTo(mouse.x, mouse.y);
                             ctx.stroke();
                        }
                    }
                }
            }

            function animate() {
                requestAnimationFrame(animate);
                ctx.clearRect(0, 0, innerWidth, innerHeight);
                for (let i = 0; i < particlesArray.length; i++) {
                    particlesArray[i].update();
                }
                connect();
            }
            
            window.addEventListener('resize', function() {
                canvas.width = innerWidth;
                canvas.height = innerHeight;
                init();
            });

            init();
            animate();
        });
    </script>
</body>
</html>